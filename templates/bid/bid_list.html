{% extends "index.html" %}
{% block mainContent %}
    {% load staticfiles %}

    {% include "query/listing_header.html" %}
    <div class="clear"></div>
    <div class="bidding_list">
    <div class="bidlisting_item">
            <div class="bidder">

                <h1>Bidder Name</h1>

            </div>
             <div class="bidder_price">
                 <h1>Bid Price({{ app.currency.currency }})</h1>
            </div>

            <div class="bidder_times">
                <h1>Bid Time</h1>
            </div>

        </div>
    {% for bid_info in bid_info_list %}
        <div class="bidlisting_item">
            <div class="bidder">

                Bidder {{ bid_info.1 }}
                {% ifequal bid_info.0.buyer.id request.user.id %}
                - {{ bid_info.0.buyer.username }}
                 {% endifequal %} has bid on {{ bid_info.2 }} listings from {{ bid_info.3 }} sellers
            </div>
             <div class="bidder_price">
                {{ bid_info.0.price|floatformat }}{{ app.currency.currency }}
                {% ifequal bid_info.0.status 2 %} - rejected{% endifequal %}
                {% ifequal bid_info.0.status 3 %} - pending{% endifequal %}
            </div>

            <div class="bidder_times">
                {{ bid_info.0.bid_time }}
            </div>

        </div>
    {% endfor %}


    </div>

<script type="text/javascript" language="javascript">
    $("#price").click(function() {
        if ($("#price").val() ==="") {
            id = '{{ app.id }}';
            $.ajax({
                type:"POST",
                url:"{% url 'query:bid_info' id %}",
                data:{
                    id:id,
                    csrfmiddlewaretoken: "{{ csrf_token }}"
                },
                success:function(data) {
                    if(data.ok === 'true' && data.bid_price != null && data.current_price != null && data.bid_num != 0) {
                        $("#bid_price").text(data.bid_price);
                        $("#current_price").text(data.current_price+"{{ app.currency.currency }}");
                        if (data.bid_num == 1) {
                            $("#bid_num").text(data.bid_num+"bid");
                        }
                        else {
                            $("#bid_num").text(data.bid_num+"bids");
                        }
                    }
                }
            });
        }
    });
    $("#bid_now").click(function() {
        if ({{ app.publisher.id }} == {{ request.user.id }}) {
            $("#price_msg").text("You can not bid your own app.");
            return false;
        }
        if ($("#price").val() =="") {
            $("#price_msg").text("The price can not be blank");
            return false;
        }
        if (isNaN($("#price").val())) {
            $("#price_msg").text("The price should be number.");
            return false;
        }
        if (parseFloat($("#price").val()) < parseFloat($("#bid_price").text())) {
            $("#price_msg").text("The price must bid at least the minimum bid");
            return false;
        }
    });
</script>
{% endblock %}