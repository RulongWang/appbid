{% extends "index.html" %}
{% block mainContent %}
{% load staticfiles %}

        <div id="breadcrumb">
            <span>Category: <a href="#">Category Parent</a> &gt <a href="#">Photography</a></span>
        </div>
        <div class="listing_header">
              <div class="listing_icon left">
                <img src="{{ MEDIA_URL }}{{ appInfo.icon }}"class="detail_icon"/>
              </div>
              <div class="listing_icon left">
                <p class="margin10px left">{{ app.title }}</p>
                <span class="margin10px">Visit <a target="_new" href="{{ app.app_store_link }}">{{ app.app_name }}</a> in the AppleStore</span>
                <div id="auctionstatus"  title="Listed: 2013-08-21T11:37:06+10:00; Ends: 2013-09-18T11:37:06+10:00">
                    {% if app.reserve_price <= current_price %}Auction has reached the reserve price{% endif %}<br>
                    Listing closes in 23 days, 18 hours<!--TODO:To do this later. -->
                </div>
              </div>
              <div class="bidding_box right">
                <div class="bidding_status" > </div>
                <div class="bidding_box">
                    $<div id="current_price">{{ current_price|floatformat|default:0 }}</div> &nbsp;
                {% ifequal app.status published %}
                    <a href="#"><div id="bid_num">{{ bid_num|floatformat|default:0 }}bid{{ bid_num|floatformat|pluralize }}</div></a>
                    <form action="{% url 'bid:bid_create' app.id %}" method="post">
                        {% csrf_token %}
                        <input id="price" name="price" type="text" />
                        <input id="bid_now" type="submit" value="Bid Now"/>
                    </form>
                    <span>(Enter $<div id="bid_price">{{ bid_price|floatformat|default:0 }}</div> or more.)</span>
                    <div id="price_msg"></div>
                {% endifequal %}
                </div>

              </div>
        </div>
        <div class="app_feature">
            <div class="feature_block">
                <ul class="feature_list">
                    <li><span class="li_title">Rating and Reviews (Current Version)</span></li>
                    <li><span>Rating:</span><span class="right margin_right_20" >{{ app.rating }}</span></li>
                    <li><span>Reviews:</span><span class="right margin_right_20" >{{ app.reviews|default:0 }}</span></li>

                </ul>
            </div>
            <div class="feature_block">
                <ul class="feature_list">
                    <li><span class="li_title">Price</span></li>
                    <li><span>Price in App Store:</span><span class="right margin_right_20" >{{ appInfo.price|floatformat|default:0 }}$</span></li>

                </ul>
            </div>
            <div class="feature_block">
                <ul class="feature_list">
                    <li><span class="li_title">Other Stats </span></li>
                    <li><span>Last Updated:</span><span class="right margin_right_20" >{{ app.last_modify|date:"jS M, Y" }}</span></li>
                    <li><span>App Support Link:</span><span class="right margin_right_20" ><a target="_new" href="{{ app.web_site }}">Support site</a></span></li>


                </ul>
            </div>
        </div>
        <div class="hint_block">

        </div>
        <div class="separator"></div>
        <div class="listing_detail">
            <div class="detail_left">
                {% autoescape off %}
                {{ app.description }}
                {% endautoescape %}
            </div>
            <div class="detail_right">
                <div class="widget">
                   <span class="widget_title">Seller</span>
                   <ul>
                       <li><span>{{ app.seller_name }}</span></li>
                   </ul>

                </div>
                <div class="widget">
                   <span class="widget_title">Claimed App Age</span>
                   <ul>
                       <li><span>App Established</span><span class="right">{{ appInfo.release_date|date:"jS M, Y" }}</span></li>
                   </ul>

                </div>
                <div class="widget">
                   <span class="widget_title">Claimed Downloads</span>
                   <ul>
                       <li><span> Downloads(monthly avg)</span><span class="right">{{ app.dl_amount|default:0 }}</span></li>
                   </ul>

                </div>
                <div class="widget">
                   <span class="widget_title">Claimed Financials</span>
                   <ul>
                       <li><span>Revenue</span><span class="right">{{ app.revenue|floatformat|default:0 }}$</span></li>
{#                       <li><span>Profit</span><span class="right">5,00${{ profit }}</span></li>#}
                   </ul>

                </div>
                <div class="widget">
                   <span class="widget_title">Monetization Methods</span>
                   <ul>
                       {% for monetize in all_monetizes %}
                       <li><span>{{ monetize.method }}</span>
                           {% if monetize in cur_monetizes %}
                               <span class="right">YES</span>
                           {% endif %}
                       </li>
                       {% endfor %}
                   </ul>

                </div>
                {% if attachments %}
                <div class="widget">
                   <span class="widget_title">Attachments</span>
                   <ul>
                       {% for attachment in attachments %}
                       <li><a target="_new" href="{{ attachment.path.url }}">{{ attachment.name }}</a></li>
                       {% endfor %}
                   </ul>
                </div>
                {% endif %}
                <div class="widget">
                   <span class="widget_title">Category </span>
                   <ul>
                       {% for category, num in category_nums.items %}
                       <li><span><a target="_new" href="#">{{ category.name }}({{ num }})</a></span></li>
                       {% endfor %}
                   </ul>
                </div>

            </div>
            <div class="clear"></div>
        </div>
<script type="text/javascript" language="javascript">
    $("#price").click(function() {
        if ($("#price").val() ==="") {
            id = '{{ app.id }}';
            $.ajax({
                type:"POST",
                url:"{% url 'query:bid_info' id %}",
                data:{
                    id:id,
                    csrfmiddlewaretoken: "{{ csrf_token }}"
                },
                success:function(data) {
                    if(data.ok === 'true' && data.bid_price != null && data.current_price != null && data.bid_num != 0) {
                        $("#bid_price").text(data.bid_price);
                        $("#current_price").text(data.current_price);
                        $("#bid_num").text(data.bid_num+"bids");
                    }
                }
            });
        }
    });
    $("#bid_now").click(function() {
        if ($("#price").val() =="") {
            $("#price_msg").text("The price can not be blank");
            return false;
        }
        if (isNaN($("#price").val())) {
            $("#price_msg").text("The price should be number.");
            return false;
        }
        if (parseFloat($("#price").val()) < parseFloat($("#bid_price").text())) {
            $("#price_msg").text("The price must bid at least the minimum bid");
            return false;
        }
    });
</script>
{% endblock %}